<template>
  <section class="survey-container">
    <div class="survey-header mt-4">
      <h1 class="survey-title">
        <span class="title-gradient">Анкета заказчика</span>
        <span class="title-underline"></span>
      </h1>
      <p class="survey-subtitle">Заполните анкету для создания технического задания</p>
    </div>

    <div class="survey-content">
      <div class="form-sections">
        <!-- Основные сведения -->
        <v-card class="form-section">
          <v-card-title class="section-title">
            <v-icon color="orange-darken-2" class="mr-2">mdi-account-details</v-icon>
            Основные сведения
          </v-card-title>
          <v-card-text>
            <v-text-field
              v-model="message.fio"
              density="comfortable"
              hide-details
              class="mb-2"
              label="ФИО заказчика"
              variant="outlined"
              :disabled="isAnyComboboxOpen"
            >
              <template v-slot:prepend-inner>
                <v-icon color="orange-darken-4"> mdi-card-account-details </v-icon>
              </template>
            </v-text-field>
            <v-text-field
              v-model="message.address"
              density="comfortable"
              hide-details
              class="mb-2"
              label="Адрес клиента"
              variant="outlined"
              :disabled="isAnyComboboxOpen"
            >
              <template v-slot:prepend-inner>
                <v-icon color="orange-darken-4"> mdi-map-marker-outline </v-icon>
              </template>
            </v-text-field>
            <v-text-field
              v-model="message.kadastr"
              density="comfortable"
              hide-details
              class="mb-2"
              label="Адрес участка (кадастровый номер)"
              variant="outlined"
              :disabled="isAnyComboboxOpen"
            >
              <template v-slot:prepend-inner>
                <v-icon color="orange-darken-4"> mdi-home-map-marker </v-icon>
              </template>
            </v-text-field>
            <v-text-field
              v-model="message.phone"
              density="comfortable"
              hide-details
              label="Телефон"
              variant="outlined"
              v-maska="'+7 (###) ###-##-##'"
              placeholder="+7 (___) ___-__-__"
              :disabled="isAnyComboboxOpen"
            >
              <template v-slot:prepend-inner>
                <v-icon color="orange-darken-4"> mdi-phone-outline </v-icon>
              </template>
            </v-text-field>
          </v-card-text>
        </v-card>

        <!-- Дополнительные сведения -->
        <v-card class="form-section">
          <v-card-title class="section-title">
            <v-icon color="orange-darken-2" class="mr-2">mdi-star-cog</v-icon>
            Дополнительные сведения
          </v-card-title>
          <v-card-text>
            <v-text-field
              v-model="message.countPeople"
              density="comfortable"
              hide-details
              class="mb-2"
              label="Число проживающих на участке"
              variant="outlined"
              :disabled="isAnyComboboxOpen"
            >
              <template v-slot:prepend-inner>
                <v-icon color="orange-darken-4"> mdi-account-multiple </v-icon>
              </template>
            </v-text-field>
            <v-text-field
              v-model="message.countPeopleDop"
              density="comfortable"
              hide-details
              class="mb-2"
              label="В том числе проживают"
              variant="outlined"
              :disabled="isAnyComboboxOpen"
            >
              <template v-slot:prepend-inner>
                <v-icon color="orange-darken-4"> mdi-account-details </v-icon>
              </template>
            </v-text-field>
            <v-text-field
              v-model="message.ageClient"
              density="comfortable"
              hide-details
              class="mb-2"
              label="Возраст клиента(ов)"
              variant="outlined"
              :disabled="isAnyComboboxOpen"
            >
              <template v-slot:prepend-inner>
                <v-icon color="orange-darken-4"> mdi-cake-variant </v-icon>
              </template>
            </v-text-field>
            <v-text-field
              v-model="message.children"
              density="comfortable"
              hide-details
              class="mb-2"
              label="Дети"
              variant="outlined"
              :disabled="isAnyComboboxOpen"
            >
              <template v-slot:prepend-inner>
                <v-icon color="orange-darken-4"> mdi-human-child </v-icon>
              </template>
            </v-text-field>
            <v-text-field
              v-model="message.childrenAge"
              density="comfortable"
              hide-details
              class="mb-2"
              label="Укажите возраст ребёнка (детей)?"
              variant="outlined"
              :disabled="isAnyComboboxOpen"
            >
              <template v-slot:prepend-inner>
                <v-icon color="orange-darken-4"> mdi-cake-variant </v-icon>
              </template>
            </v-text-field>
            <v-text-field
              v-model="message.animal"
              density="comfortable"
              hide-details
              class="mb-2"
              label="Домашние животные"
              variant="outlined"
              :disabled="isAnyComboboxOpen"
            >
              <template v-slot:prepend-inner>
                <v-icon color="orange-darken-4"> mdi-paw-outline </v-icon>
              </template>
            </v-text-field>
            <v-select
              v-model="message.personGroup"
              :items="['Есть', 'Нет', 'Планируется', 'Не планируется']"
              label="Обслуживающий персонал"
              chips
              variant="outlined"
              multiple
              density="comfortable"
              hide-details
              class="mb-2 test"
              :disabled="isAnyComboboxOpen && currentOpenCombobox !== 'personAid'"
              @click:control="handleComboboxClick('personAid')"
              @update:menu="(isOpen) => handleMenuUpdate(isOpen, 'personAid')"
              ref="personAidCombobox"
            >
              <template v-slot:prepend-inner>
                <v-icon color="orange-darken-4"> mdi-account-group </v-icon>
              </template></v-select
            >
            <v-select
              v-model="message.inval"
              :items="['Есть', 'Нет', 'Требуется предусмотреть пандусы', 'Другое']"
              label="Маломобильные пользователи"
              chips
              variant="outlined"
              multiple
              density="comfortable"
              hide-details
              class="mb-2 test"
              :disabled="isAnyComboboxOpen && currentOpenCombobox !== 'mobilityAid'"
              @click:control="handleComboboxClick('mobilityAid')"
              @update:menu="(isOpen) => handleMenuUpdate(isOpen, 'mobilityAid')"
              ref="mobilityAidCombobox"
            >
              <template v-slot:prepend-inner>
                <v-icon color="orange-darken-4"> mdi-wheelchair-accessibility </v-icon>
              </template></v-select
            >
            <v-select
              v-model="message.allergy"
              density="comfortable"
              hide-details
              chips
              class="mb-2"
              label="Наличие аллергических реакций"
              :items="['Нет', 'Да']"
              variant="outlined"
              :disabled="isAnyComboboxOpen && currentOpenCombobox !== 'allergies'"
              @click:control="handleComboboxClick('allergies')"
              @update:menu="(isOpen) => handleMenuUpdate(isOpen, 'allergies')"
              ref="allergiesCombobox"
            >
              <template v-slot:prepend-inner>
                <v-icon color="orange-darken-4"> mdi-flower-pollen </v-icon>
              </template>
            </v-select>
            <v-text-field
              v-if="message.allergy.includes('Да')"
              v-model="message.isAllergy"
              density="comfortable"
              hide-details
              class="mb-2"
              label="На что у Вас аллергия?"
              prepend-inner-icon="mdi-hospital-box"
              variant="outlined"
              :disabled="isAnyComboboxOpen"
            ></v-text-field>
          </v-card-text>
        </v-card>

        <!-- Функциональные зоны -->
        <v-card class="form-section">
          <v-card-title class="section-title">
            <v-icon color="orange-darken-2" class="mr-2">mdi-view-grid-outline</v-icon>
            Функциональные зоны
          </v-card-title>
          <v-card-text>
            <v-select
              density="comfortable"
              hide-details
              chips
              class="mb-2"
              multiple
              label="Отдых/досуг"
              v-model="message.leisure"
              style="font-size: 14px !important"
              :items="[
                'Газон для активных игр',
                'Зона открытого огня',
                'Декоративный водный объект (природный пруд, фонтан, сухой ручей и тд.)',
                'Солярий',
                'Бассейн',
                'Беседка',
                'Терраса',
                'Летняя кухня',
                'Детская площадка',
                'Качель/гамак',
                'Нет в списке',
              ]"
              variant="outlined"
              :disabled="isAnyComboboxOpen && currentOpenCombobox !== 'leisure'"
              @click:control="handleComboboxClick('leisure')"
              @update:menu="(isOpen) => handleMenuUpdate(isOpen, 'leisure')"
              ref="leisureCombobox"
            >
              <template v-slot:prepend-inner>
                <v-icon color="orange-darken-4"> mdi-umbrella-beach </v-icon>
              </template>
            </v-select>

            <v-text-field
              v-if="message.leisure.includes('Беседка')"
              prepend-inner-icon="mdi-pencil"
              v-model="message.alcove"
              density="comfortable"
              hide-details
              class="mb-2"
              label="Максимальное число людей в беседке единовременно"
              variant="outlined"
              :disabled="isAnyComboboxOpen"
            >
            </v-text-field>
            <v-text-field
              v-if="message.leisure.includes('Терраса')"
              prepend-inner-icon="mdi-pencil"
              v-model="message.terrace"
              density="comfortable"
              hide-details
              class="mb-2"
              label="Максимальное число людей на террасе единовременно"
              variant="outlined"
              :disabled="isAnyComboboxOpen"
            ></v-text-field>
            <v-select
              v-model="message.hobby"
              density="comfortable"
              hide-details
              chips
              class="mb-2"
              multiple
              label="Хобби"
              :items="['Кулинария', 'Настольные игры', 'Спорт', 'Собаководство', 'Нет в списке']"
              variant="outlined"
              :disabled="isAnyComboboxOpen && currentOpenCombobox !== 'hobby'"
              @click:control="handleComboboxClick('hobby')"
              @update:menu="(isOpen) => handleMenuUpdate(isOpen, 'hobby')"
              ref="hobbyCombobox"
            >
              <template v-slot:prepend-inner>
                <v-icon color="orange-darken-4"> mdi-palette-outline </v-icon>
              </template>
            </v-select>
            <v-text-field
              v-if="message.hobby.includes('Спорт')"
              prepend-inner-icon="mdi-run"
              v-model="message.sport"
              density="comfortable"
              hide-details
              class="mb-2"
              label="Вид спорта"
              variant="outlined"
              :disabled="isAnyComboboxOpen"
            ></v-text-field>
            <v-select
              v-model="message.utilityBlock"
              density="comfortable"
              hide-details
              chips
              class="mb-2"
              multiple
              label="Хозяйственный блок"
              :items="[
                'Гараж',
                'Парковка',
                'Зона огорода',
                'Теплица',
                'Погреб для хранения овощей',
                'Компост',
                'Хозблок',
                'Кладовая для садового инвентаря',
                'Мусорные баки',
                'Туалет',
                'Нет в списке',
              ]"
              variant="outlined"
              :disabled="isAnyComboboxOpen && currentOpenCombobox !== 'utilityBlock'"
              @click:control="handleComboboxClick('utilityBlock')"
              @update:menu="(isOpen) => handleMenuUpdate(isOpen, 'utilityBlock')"
              ref="utilityBlockCombobox"
            >
              <template v-slot:prepend-inner>
                <v-icon color="orange-darken-4"> mdi-tools </v-icon>
              </template>
            </v-select>
            <v-text-field
              v-if="message.utilityBlock.includes('Гараж')"
              v-model="message.garage"
              prepend-inner-icon="mdi-garage"
              density="comfortable"
              hide-details
              class="mb-2"
              label="На сколько машин гараж"
              variant="outlined"
              :disabled="isAnyComboboxOpen"
            ></v-text-field>
            <v-text-field
              v-if="message.utilityBlock.includes('Парковка')"
              prepend-inner-icon="mdi-parking"
              v-model="message.parking"
              density="comfortable"
              hide-details
              class="mb-2"
              label="На сколько машин парковка"
              variant="outlined"
              :disabled="isAnyComboboxOpen"
            ></v-text-field>
            <v-text-field
              v-if="message.utilityBlock.includes('Зона огорода')"
              prepend-inner-icon="mdi-carrot"
              v-model="message.gardenArea"
              density="comfortable"
              hide-details
              class="mb-2"
              label="Примерное кол-во посадок в огороде"
              variant="outlined"
              :disabled="isAnyComboboxOpen"
            ></v-text-field>
            <v-text-field
              v-if="message.utilityBlock.includes('Теплица')"
              prepend-inner-icon="mdi-greenhouse"
              v-model="message.greenhouse"
              density="comfortable"
              hide-details
              class="mb-2"
              label="Размер теплицы"
              variant="outlined"
              :disabled="isAnyComboboxOpen"
            ></v-text-field>
            <v-select
              v-model="message.air"
              :items="['Да', 'Нет']"
              label="Развлечения/обеды на открытом воздухе"
              chips
              variant="outlined"
              density="comfortable"
              hide-details
              class="mb-2"
              :disabled="isAnyComboboxOpen && currentOpenCombobox !== 'air'"
              @click:control="handleComboboxClick('air')"
              @update:menu="(isOpen) => handleMenuUpdate(isOpen, 'air')"
              ref="airCombobox"
            >
              <template v-slot:prepend-inner>
                <v-icon color="orange-darken-4"> mdi-grill </v-icon>
              </template>
            </v-select>
            <v-text-field
              v-if="message.air.includes('Да')"
              v-model="message.howOftenAir"
              density="comfortable"
              hide-details
              class="mb-2"
              label="Как часто развлечения/обеды"
              variant="outlined"
              prepend-inner-icon="mdi-calendar"
              :disabled="isAnyComboboxOpen"
            ></v-text-field>
            <v-text-field
              v-if="
                message.leisure.includes('Нет в списке') ||
                message.hobby.includes('Нет в списке') ||
                message.utilityBlock.includes('Нет в списке')
              "
              v-model="message.dopZone"
              density="comfortable"
              hide-details
              class="mb-2"
              label="Иная дополнительная зона*"
              variant="outlined"
              prepend-inner-icon="mdi-plus-box"
              :disabled="isAnyComboboxOpen"
            >
            </v-text-field>
            <v-textarea
              v-model="message.addReq"
              rows="1"
              auto-grow
              hide-details
              class="pb-0 mb-4 test"
              label="Дополнительные требования"
              variant="outlined"
              :disabled="isAnyComboboxOpen"
            ></v-textarea>
          </v-card-text>
        </v-card>

        <!-- Предпочтения -->
        <v-card class="form-section">
          <v-card-title class="section-title">
            <v-icon color="orange-darken-2" class="mr-2">mdi-heart-outline</v-icon>
            Ваши предпочтения
          </v-card-title>
          <v-card-text>
            <v-select
              v-model="message.garden"
              density="comfortable"
              hide-details
              chips
              class="mb-2"
              multiple
              label="Элементы сада"
              :items="[
                'Малые архитектурные формы',
                'Арки/перголы',
                'Пряно-ароматические травы',
                'Ягодные кустарники',
                'Фруктовые деревья',
                'Вы коллекционер и собираете в саду коллекцию',
                'Нет в списке',
              ]"
              variant="outlined"
              :disabled="isAnyComboboxOpen && currentOpenCombobox !== 'garden'"
              @click:control="handleComboboxClick('garden')"
              @update:menu="(isOpen) => handleMenuUpdate(isOpen, 'garden')"
              ref="gardenCombobox"
            >
              <template v-slot:prepend-inner>
                <v-icon color="orange-darken-4"> mdi-flower-tulip-outline </v-icon>
              </template>
            </v-select>
            <v-text-field
              v-if="message.garden.includes('Нет в списке')"
              v-model="message.elemGarden"
              density="comfortable"
              hide-details
              class="mb-2"
              label="Элемент сада"
              variant="outlined"
              prepend-inner-icon="mdi-pencil-outline"
              :disabled="isAnyComboboxOpen"
            ></v-text-field>
            <v-text-field
              v-if="message.garden.includes('Ягодные кустарники')"
              v-model="message.berryBushes"
              density="comfortable"
              hide-details
              class="mb-2"
              label="Виды ягодных кустарников"
              variant="outlined"
              prepend-inner-icon="mdi-pencil-outline"
              :disabled="isAnyComboboxOpen"
            ></v-text-field>
            <v-text-field
              v-if="message.garden.includes('Фруктовые деревья')"
              v-model="message.fruitTrees"
              density="comfortable"
              hide-details
              class="mb-2"
              label="Виды фруктовых деревьев"
              variant="outlined"
              prepend-inner-icon="mdi-pencil-outline"
              :disabled="isAnyComboboxOpen"
            ></v-text-field>
            <v-text-field
              v-if="message.garden.includes('Вы коллекционер и собираете в саду коллекцию')"
              v-model="message.collection"
              density="comfortable"
              hide-details
              class="mb-2"
              label="Какую коллекцию Вы хотите собрать?"
              variant="outlined"
              prepend-inner-icon="mdi-pencil-outline"
              :disabled="isAnyComboboxOpen"
            ></v-text-field>
            <v-select
              v-model="message.style"
              density="comfortable"
              hide-details
              chips
              class="mb-2"
              multiple
              label="Стиль"
              :items="[
                'Классика/регулярный',
                'Классика/пейзажный',
                'Прованс/деревенский',
                'Технологический/хай-тек',
                'Минималистический',
                'Скандинавский',
                'Нет в списке',
              ]"
              variant="outlined"
              :disabled="isAnyComboboxOpen && currentOpenCombobox !== 'style'"
              @click:control="handleComboboxClick('style')"
              @update:menu="(isOpen) => handleMenuUpdate(isOpen, 'style')"
              ref="styleCombobox"
            >
              <template v-slot:prepend-inner>
                <v-icon color="orange-darken-4"> mdi-palette-outline </v-icon>
              </template>
            </v-select>
            <v-card-subtitle class="pl-1 mb-1">Какие растения Вы хотите видеть в саду</v-card-subtitle>
            <v-select
              v-model="message.plants"
              density="comfortable"
              hide-details
              chips
              class="mb-2"
              multiple
              label="Виды растений"
              :items="[
                'Пик декоративности (для ежегодных семейных праздников)',
                'Осенне-цветущие',
                'Весенне-цветущие',
                'Непрерывного цветения',
                'Ароматные',
                'Другие',
              ]"
              variant="outlined"
              :disabled="isAnyComboboxOpen && currentOpenCombobox !== 'plants'"
              @click:control="handleComboboxClick('plants')"
              @update:menu="(isOpen) => handleMenuUpdate(isOpen, 'plants')"
              ref="plantsCombobox"
            >
              <template v-slot:prepend-inner>
                <v-icon color="orange-darken-4"> mdi-leaf-circle-outline </v-icon>
              </template>
            </v-select>
            <v-card-subtitle v-if="message.plants.includes('Пик декоративности (для ежегодных семейных праздников)')" class="pl-1 mb-1"
              >В каком месяце требуется обильное цветение?</v-card-subtitle
            >
            <v-text-field
              v-if="message.plants.includes('Пик декоративности (для ежегодных семейных праздников)')"
              v-model="message.monthOfFlowering"
              density="comfortable"
              hide-details
              class="mb-2"
              label="Месяц/месяца обильного цветения"
              variant="outlined"
              prepend-inner-icon="mdi-pencil-outline"
              :disabled="isAnyComboboxOpen"
            >
            </v-text-field>
            <v-card-subtitle class="pl-1 mb-1">Предпочтения по растениям</v-card-subtitle>
            <v-text-field
              v-model="message.plantsLike"
              density="comfortable"
              hide-details
              class="mb-2"
              label="Какие растения Вам нравятся?"
              variant="outlined"
              :disabled="isAnyComboboxOpen"
            >
              <template v-slot:prepend-inner>
                <v-icon color="orange-darken-4"> mdi-thumb-up-outline </v-icon>
              </template>
            </v-text-field>
            <v-text-field
              v-model="message.plantsDisLike"
              density="comfortable"
              hide-details
              class="mb-2"
              label="Какие растения Вам не нравятся?"
              variant="outlined"
              :disabled="isAnyComboboxOpen"
            >
              <template v-slot:prepend-inner>
                <v-icon color="orange-darken-4"> mdi-thumb-down-outline </v-icon>
              </template>
            </v-text-field>
            <v-card-subtitle class="pl-1 mb-1">Цветовые предпочтения</v-card-subtitle>
            <v-text-field
              v-model="message.colorLike"
              density="comfortable"
              hide-details
              class="mb-2"
              label="Какие цвета Вам нравятся?"
              variant="outlined"
              :disabled="isAnyComboboxOpen"
            >
              <template v-slot:prepend-inner>
                <v-icon color="orange-darken-4"> mdi-thumb-up-outline </v-icon>
              </template>
            </v-text-field>
            <v-text-field
              v-model="message.colorDisLike"
              density="comfortable"
              hide-details
              class="mb-2"
              label="Какие цвета Вам не нравятся?"
              variant="outlined"
              :disabled="isAnyComboboxOpen"
            >
              <template v-slot:prepend-inner>
                <v-icon color="orange-darken-4"> mdi-thumb-down-outline </v-icon>
              </template>
            </v-text-field>
            <v-text-field
              v-model="message.interior"
              density="comfortable"
              hide-details
              class="mb-2"
              label="Какие оттенки в интерьере хотелось бы повторить в ландшафте"
              variant="outlined"
              :disabled="isAnyComboboxOpen"
            >
              <template v-slot:prepend-inner>
                <v-icon color="orange-darken-4"> mdi-palette-advanced </v-icon>
              </template>
            </v-text-field>
          </v-card-text>
        </v-card>

        <!-- Технические вопросы -->
        <v-card class="form-section">
          <v-card-title class="section-title">
            <v-icon color="orange-darken-2" class="mr-2">mdi-cog-outline</v-icon>
            Технические вопросы
          </v-card-title>
          <v-card-text>
            <v-select
              v-model="message.lighting"
              :items="[
                'Дежурное освещение',
                'Декоративное освещение (подсветка растений, деревьев, низкие фонари, направленный свет)',
                'Внешняя подсветка фасадов строений усадьбы',
              ]"
              label="Система освещения"
              chips
              variant="outlined"
              multiple
              density="comfortable"
              hide-details
              class="mb-2"
              :disabled="isAnyComboboxOpen && currentOpenCombobox !== 'lighting'"
              @click:control="handleComboboxClick('lighting')"
              @update:menu="(isOpen) => handleMenuUpdate(isOpen, 'lighting')"
              ref="lightingCombobox"
            >
              <template v-slot:prepend-inner>
                <v-icon color="orange-darken-4"> mdi-wall-sconce-flat-outline </v-icon>
              </template>
            </v-select>
            <v-select
              v-model="message.irrigationSystem"
              :items="['Нет, не нужна', 'Да, автоматический полив', 'Да, механический полив']"
              label="Система полива"
              chips
              variant="outlined"
              multiple
              density="comfortable"
              hide-details
              class="mb-2"
              :disabled="isAnyComboboxOpen && currentOpenCombobox !== 'irrigationSystem'"
              @click:control="handleComboboxClick('irrigationSystem')"
              @update:menu="(isOpen) => handleMenuUpdate(isOpen, 'irrigationSystem')"
              ref="irrigationSystemCombobox"
            >
              <template v-slot:prepend-inner>
                <v-icon color="orange-darken-4"> mdi-sprinkler </v-icon>
              </template>
            </v-select>
            <v-select
              v-model="message.water"
              :items="[
                'Бочка с водой',
                'Централизованное водоснабжение',
                'Собственная скважина',
                'Участок прилегает к естественному водоему',
                'Воды нет',
              ]"
              label="Расположение водопровода и точки подключения к системе водоснабжения"
              chips
              variant="outlined"
              multiple
              density="comfortable"
              hide-details
              class="mb-2"
              :disabled="isAnyComboboxOpen && currentOpenCombobox !== 'water'"
              @click:control="handleComboboxClick('water')"
              @update:menu="(isOpen) => handleMenuUpdate(isOpen, 'water')"
              ref="waterCombobox"
            >
              <template v-slot:prepend-inner>
                <v-icon color="orange-darken-4"> mdi-water-pump </v-icon>
              </template>
            </v-select>
            <v-card-subtitle style="white-space: normal" class="pl-1 mb-1"
              >Строительные материалы, которые хотелось бы использовать в благоустройстве</v-card-subtitle
            >
            <v-select
              v-model="message.buildingMaterials"
              density="comfortable"
              hide-details
              chips
              class="mb-2"
              multiple
              label="Строительные материалы"
              :items="[
                'Террасная доска (натуральная, композитная)',
                'Натуральный камень',
                'Тротуарная плитка',
                'Брусчатка',
                'Металл/ковка',
                'Резиновые покрытия',
                'Щебеночные покрытия',
              ]"
              variant="outlined"
              :disabled="isAnyComboboxOpen && currentOpenCombobox !== 'buildingMaterials'"
              @click:control="handleComboboxClick('buildingMaterials')"
              @update:menu="(isOpen) => handleMenuUpdate(isOpen, 'buildingMaterials')"
              ref="buildingMaterialsCombobox"
            >
              <template v-slot:prepend-inner>
                <v-icon color="orange-darken-4"> mdi-floor-plan </v-icon>
              </template>
            </v-select>
            <v-card-subtitle class="pl-1 mb-1">Демонтаж и изменения</v-card-subtitle>
            <v-select
              v-model="message.dismantling"
              :items="['Строения', 'Деревья']"
              label="Объекты которые можно/нужно убарть/демонтировать"
              chips
              variant="outlined"
              multiple
              density="comfortable"
              hide-details
              class="mb-2"
              :disabled="isAnyComboboxOpen && currentOpenCombobox !== 'dismantling'"
              @click:control="handleComboboxClick('dismantling')"
              @update:menu="(isOpen) => handleMenuUpdate(isOpen, 'dismantling')"
              ref="dismantlingCombobox"
            >
              <template v-slot:prepend-inner>
                <v-icon color="orange-darken-4"> mdi-hammer-wrench </v-icon>
              </template>
            </v-select>
            <v-text-field
              v-if="message.dismantling.includes('Строения') || message.dismantling.includes('Деревья')"
              v-model="message.viewDismantling"
              density="comfortable"
              hide-details
              class="mb-2"
              label="Укажите строения или деревья"
              variant="outlined"
              :disabled="isAnyComboboxOpen"
            ></v-text-field>
            <v-select
              v-model="message.changes"
              :items="['Ограждение/забор', 'Декорировать стены', 'Мощение', 'Освещение', 'Система полива']"
              label="Что Вы хотели бы изменить?"
              chips
              variant="outlined"
              multiple
              density="comfortable"
              hide-details
              class="mb-2"
              :disabled="isAnyComboboxOpen && currentOpenCombobox !== 'changes'"
              @click:control="handleComboboxClick('changes')"
              @update:menu="(isOpen) => handleMenuUpdate(isOpen, 'changes')"
              ref="changesCombobox"
            >
              <template v-slot:prepend-inner>
                <v-icon color="orange-darken-4"> mdi-brush </v-icon>
              </template></v-select
            >

            <v-textarea
              v-model="message.dopChanges"
              rows="1"
              auto-grow
              hide-details
              class="pb-0 mb-4 test"
              label="Дополнительные требования"
              variant="outlined"
              :disabled="isAnyComboboxOpen"
            ></v-textarea>
          </v-card-text>
        </v-card>

        <!-- Обслуживание сада -->
        <v-card class="form-section">
          <v-card-title class="section-title">
            <v-icon color="orange-darken-2" class="mr-2">mdi-leaf</v-icon>
            Обслуживание сада
          </v-card-title>
          <v-card-text>
            <v-textarea
              v-model="message.experienceGarden"
              rows="1"
              auto-grow
              hide-details
              class="pb-0 mb-2"
              label="Каков Ваш опыт работы в саду и насколько она Вам интересна?"
              variant="outlined"
              :disabled="isAnyComboboxOpen"
            >
              <template v-slot:prepend-inner>
                <v-icon color="orange-darken-4"> mdi-sprout </v-icon>
              </template>
            </v-textarea>
            <v-textarea
              v-model="message.hourGarden"
              rows="1"
              auto-grow
              hide-details
              class="pb-0 mb-2"
              label="Сколько часов Вы тратите на работу в саду в настоящее время?"
              variant="outlined"
              :disabled="isAnyComboboxOpen"
            >
              <template v-slot:prepend-inner>
                <v-icon color="orange-darken-4"> mdi-clock-outline </v-icon>
              </template>
            </v-textarea>
            <v-textarea
              v-model="message.wantHourGarden"
              rows="1"
              auto-grow
              hide-details
              class="pb-0 mb-2"
              label="Сколько часов Вы хотите тратить на работу в саду?"
              variant="outlined"
              :disabled="isAnyComboboxOpen"
            >
              <template v-slot:prepend-inner>
                <v-icon color="orange-darken-4"> mdi-timer-cog-outline </v-icon>
              </template>
            </v-textarea>
            <v-textarea
              v-model="message.likeWork"
              rows="1"
              auto-grow
              hide-details
              class="pb-0 mb-2"
              label="Какие садовые работы Вам особенно нравятся?"
              variant="outlined"
              :disabled="isAnyComboboxOpen"
            >
              <template v-slot:prepend-inner>
                <v-icon color="orange-darken-4"> mdi-heart-outline </v-icon>
              </template>
            </v-textarea>
            <v-textarea
              v-model="message.interfereGarden"
              rows="1"
              auto-grow
              hide-details
              class="pb-0 mb-2"
              label="Что мешает Вам наслаждатся садом (недостаток уединенности, много шума)?"
              variant="outlined"
              :disabled="isAnyComboboxOpen"
            >
              <template v-slot:prepend-inner>
                <v-icon color="orange-darken-4"> mdi-close-circle-outline </v-icon>
              </template></v-textarea
            >
          </v-card-text>
        </v-card>
        <!-- Дополнительная информация -->
        <v-card class="form-section">
          <v-card-title class="section-title">
            <v-icon color="orange-darken-2" class="mr-2">mdi-note-edit-outline</v-icon>
            Дополнительная информация, необходимая при проектировании
          </v-card-title>
          <v-card-text>
            <v-select
              v-model="message.dopInfo"
              :items="[
                'Имеются переувлажненные участки',
                'Имеются пересушенные участки',
                'Имеются ветренные зоны',
                'Имеются дурнопахнущие участки',
              ]"
              label="Дополнительная информация"
              chips
              variant="outlined"
              multiple
              density="comfortable"
              hide-details
              class="mb-2"
              :disabled="isAnyComboboxOpen && currentOpenCombobox !== 'dopInfo'"
              @click:control="handleComboboxClick('dopInfo')"
              @update:menu="(isOpen) => handleMenuUpdate(isOpen, 'dopInfo')"
              ref="dopInfoCombobox"
            >
              <template v-slot:prepend-inner>
                <v-icon color="orange-darken-4"> mdi-information-outline </v-icon>
              </template>
            </v-select>
            <v-textarea
              v-model="message.detailsInfo"
              rows="1"
              auto-grow
              hide-details
              class="pb-0 mb-4"
              label="Подробности"
              variant="outlined"
              :disabled="isAnyComboboxOpen"
            ></v-textarea>
          </v-card-text>
        </v-card>
      </div>

      <div class="form-actions">
        <!-- <v-btn color="primary" size="large" @click="clickBtn" class="submit-btn"> Отправить анкету </v-btn> -->
        <v-btn
          color="primary"
          size="large"
          @click="clickBtn"
          class="submit-btn"
          :disabled="sendingStatus.isLoading"
          :loading="sendingStatus.isLoading"
        >
          <template v-slot:loader>
            <v-progress-circular indeterminate color="white" size="24" width="3"></v-progress-circular>
            <span class="ml-2">Отправка...</span>
          </template>
          Отправить анкету
        </v-btn>
      </div>
    </div>

    <!-- Уведомление об успешной отправке -->
    <!-- <v-snackbar v-model="snackbar.value" location="top center" :timeout="3000" color="success" rounded="pill">
      <div class="d-flex align-center">
        <v-icon icon="mdi-check-circle" class="mr-2"></v-icon>
        <span>Данные успешно отправлены!</span>
      </div>
    </v-snackbar> -->
    <v-snackbar v-model="snackbar.value" location="top center" timeout="5000" color="success" rounded="pill">
      <div class="d-flex align-center">
        <v-icon icon="mdi-check-circle" class="mr-2"></v-icon>
        <span>Данные успешно отправлены!</span>
      </div>
    </v-snackbar>

    <!-- Уведомление об ошибке -->
    <v-snackbar v-model="sendingStatus.error" color="error" timeout="5000" location="bottom right">
      {{ sendingStatus.error }}
      <template v-slot:actions>
        <v-btn variant="text" @click="sendingStatus.error = null"> Закрыть </v-btn>
      </template>
    </v-snackbar>
  </section>
</template>

<script setup>
import { onMounted, computed, reactive, ref } from "vue";
import { sendMessageTG, CHATS_ID, TOPICS_ID } from "../services/botService";
useHead({
  title: "Анкета по проекту",
  titleTemplate: "%s %separator %siteName",
});

const snackbar = reactive({
  value: false,
});

const sendingStatus = reactive({
  isLoading: false,
  isSuccess: false,
  error: null,
});

const message = reactive({
  fio: "",
  address: "",
  kadastr: "",
  phone: "",

  countPeople: "",
  countPeopleDop: "",
  ageClient: "",
  children: "",
  childrenAge: "",
  animal: "",
  personGroup: [],
  inval: [],
  allergy: [],
  isAllergy: "",

  leisure: [],
  alcove: "",
  terrace: "",
  hobby: [],
  sport: "",
  utilityBlock: [],
  garage: "",
  parking: "",
  gardenArea: "",
  greenhouse: "",
  air: [],
  howOftenAir: "",
  dopZone: "",
  addReq: "",

  garden: [],
  elemGarden: "",
  berryBushes: "",
  fruitTrees: "",
  collection: "",
  style: [],
  plants: [],
  monthOfFlowering: "",
  plantsLike: "",
  plantsDisLike: "",
  colorLike: "",
  colorDisLike: "",
  interior: "",
  lighting: [],
  irrigationSystem: [],
  water: [],
  buildingMaterials: [],
  dismantling: [],
  viewDismantling: "",
  changes: [],
  dopChanges: "",
  dopInfo: [],
  detailsInfo: "",
  experienceGarden: "",
  hourGarden: "",
  wantHourGarden: "",
  likeWork: "",
  interfereGarden: "",
});

const formattedText = computed(() => {
  const text = [
    `
    👨🏻 Анкета (проектирование)
${message.fio != "" || message.address != "" || message.kadastr != "" || message.phone != "" ? `[line]` : ""}
${message.fio != "" ? `ФИО: ${message.fio}` : ""}
${message.address != "" ? `Адрес клиента: ${message.address}` : ""}
${message.kadastr != "" ? `Адрес участка: ${message.kadastr}` : ""}
${message.phone != "" ? `Телефон: ${message.phone}` : ""}
${
  message.countPeople != "" ||
  message.countPeopleDop != "" ||
  message.ageClient != "" ||
  message.children != "" ||
  message.childrenAge != "" ||
  message.animal != "" ||
  message.personGroup.length > 0 ||
  message.inval.length > 0 ||
  message.allergy.length > 0
    ? `[line]`
    : ""
}
${
  message.countPeople != "" ||
  message.countPeopleDop != "" ||
  message.ageClient != "" ||
  message.children != "" ||
  message.childrenAge != "" ||
  message.animal != "" ||
  message.personGroup.length > 0 ||
  message.inval.length > 0 ||
  message.allergy.length > 0
    ? `⭐️⭐️⭐️ Дополнительные сведения\n`
    : ""
}
${message.countPeople != "" ? `Число проживающих на участке: ${message.countPeople}` : ""}
${message.countPeopleDop != "" ? `В том числе проживают: ${message.countPeopleDop}` : ""}
${message.ageClient != "" ? `Возраст клиента(ов): ${message.ageClient}` : ""}
${message.children != "" ? `Дети: ${message.children}` : ""}
${message.childrenAge != "" ? `Возраст ребенка (детей): ${message.childrenAge}` : ""}
${message.animal != "" ? `Домашние животные: ${message.animal}` : ""}
${message.personGroup.length > 0 ? `● Обслуживающий персонал` : ""}
${message.personGroup ? `${message.personGroup.map((task) => `● ${task}`).join("\n")}` : ""}
${message.inval.length > 0 ? `⭐️ Маломобильные пользователи` : ""}
${message.inval ? `${message.inval.map((task) => `● ${task}`).join("\n")}` : ""}
${message.allergy != "" ? `● Наличие аллергических реакций: ${message.allergy}` : ""}
${message.isAllergy != "" ? `На что аллергия: ${message.isAllergy}` : ""}
${
  message.leisure.length > 0 ||
  message.hobby.length > 0 ||
  message.utilityBlock.length > 0 ||
  message.air.length > 0 ||
  message.addReq != ""
    ? `[line]`
    : ""
}
${
  message.leisure.length > 0 ||
  message.hobby.length > 0 ||
  message.utilityBlock.length > 0 ||
  message.air.length > 0 ||
  message.addReq != ""
    ? `⭐️⭐️⭐️ Функциональные зоны\n`
    : ""
}
${message.leisure.length > 0 ? `⭐️ Отдых (досуг)` : ""}
${message.leisure ? `${message.leisure.map((task) => `● ${task}`).join("\n")}` : ""}
${message.alcove != "" ? `Максимально людей в беседке: ${message.alcove}` : ""}
${message.terrace != "" ? `Максимально людей на террасе: ${message.terrace}` : ""}

${message.hobby.length > 0 ? `⭐️ Хобби` : ""}
${message.hobby ? `${message.hobby.map((task) => `● ${task}`).join("\n")}` : ""}
${message.sport != "" ? `Вид спорта: ${message.sport}` : ""}
${message.utilityBlock.length > 0 ? `⭐️ Хозяйственный блок` : ""}
${message.utilityBlock ? `${message.utilityBlock.map((task) => `● ${task}`).join("\n")}` : ""}
${message.garage != "" ? `На сколько машин гараж: ${message.garage}` : ""}
${message.parking != "" ? `На сколько машин парковка: ${message.parking}` : ""}
${message.gardenArea != "" ? `Посадок в огороде: ${message.gardenArea}` : ""}
${message.greenhouse != "" ? `Размер теплицы: ${message.greenhouse}` : ""}
${message.air != "" ? `● Развлечения на открытом воздухе: ${message.air}` : ""}
${message.howOftenAir != "" ? `Переодичность: ${message.howOftenAir}` : ""}
${message.dopZone != "" ? `Иная дополнительная зона: ${message.dopZone}` : ""}
${message.addReq != "" ? `Дополнительные требования: ${message.addReq}` : ""}
${
  message.garden.length > 0 ||
  message.style.length > 0 ||
  message.plants.length > 0 ||
  message.plantsLike != "" ||
  message.plantsDisLike != "" ||
  message.colorLike != "" ||
  message.colorDisLike != "" ||
  message.interior != ""
    ? `[line]`
    : ""
}
${
  message.garden.length > 0 ||
  message.style.length > 0 ||
  message.plants.length > 0 ||
  message.plantsLike != "" ||
  message.plantsDisLike != "" ||
  message.colorLike != "" ||
  message.colorDisLike != "" ||
  message.interior != ""
    ? `⭐️⭐️⭐️ Предпочтения\n`
    : ""
}
${message.garden.length > 0 ? `⭐️ Элементы сада` : ""}
${message.garden ? `${message.garden.map((task) => `● ${task}`).join("\n")}` : ""}
${message.berryBushes != "" ? `Ягодные кустарники: ${message.berryBushes}` : ""}
${message.fruitTrees != "" ? `Фруктовые деревья: ${message.fruitTrees}` : ""}
${message.collection != "" ? `Коллекция: ${message.collection}` : ""}
${message.style.length > 0 ? `⭐️ Стиль` : ""}
${message.style ? `${message.style.map((task) => `● ${task}`).join("\n")}` : ""}
${message.plants.length > 0 ? `⭐️ Растения` : ""}
${message.plants ? `${message.plants.map((task) => `● ${task}`).join("\n")}` : ""}
${message.monthOfFlowering != "" ? `Месяц обильного цветения: ${message.monthOfFlowering}` : ""}
${message.plantsLike != "" ? `Растения которые нравятся: ${message.plantsLike}` : ""}
${message.plantsDisLike != "" ? `Растения которые не нравятся: ${message.plantsDisLike}` : ""}
${message.colorLike != "" || message.colorDisLike != "" || message.interior != "" ? `⭐️ Цветовые предпочтения` : ""}
${message.colorLike != "" ? `Цвета которые нравятся: ${message.colorLike}` : ""}
${message.colorDisLike != "" ? `Цвета которые не нравятся: ${message.colorDisLike}` : ""}
${message.interior != "" ? `Оттенки интерьера для ландшафта: ${message.interior}` : ""}
${
  message.lighting.length > 0 ||
  message.irrigationSystem.length > 0 ||
  message.water.length > 0 ||
  message.buildingMaterials > 0 ||
  message.dismantling > 0 ||
  message.viewDismantling != "" ||
  message.changes > 0 ||
  message.dopChanges != ""
    ? `[line]`
    : ""
}
${
  message.lighting.length > 0 ||
  message.irrigationSystem.length > 0 ||
  message.water.length > 0 ||
  message.buildingMaterials > 0 ||
  message.dismantling > 0 ||
  message.viewDismantling != "" ||
  message.changes > 0 ||
  message.dopChanges != ""
    ? `⭐️⭐️⭐️ Технические вопросы\n`
    : ""
}
${message.lighting.length > 0 ? `⭐️ Система освещения` : ""}
${message.lighting ? `${message.lighting.map((task) => `● ${task}`).join("\n")}` : ""}
${message.irrigationSystem.length > 0 ? `⭐️ Система полива` : ""}
${message.irrigationSystem ? `${message.irrigationSystem.map((task) => `● ${task}`).join("\n")}` : ""}
${message.water.length > 0 ? `⭐️ Точка подключения воды` : ""}
${message.water ? `${message.water.map((task) => `● ${task}`).join("\n")}` : ""}
${message.buildingMaterials.length > 0 ? `⭐️ Строительные материалы` : ""}
${message.buildingMaterials ? `${message.buildingMaterials.map((task) => `● ${task}`).join("\n")}` : ""}
${message.dismantling.length > 0 ? `⭐️ Демонтаж и изменения` : ""}
${message.dismantling ? `${message.dismantling.map((task) => `● ${task}`).join("\n")}` : ""}
${message.viewDismantling != "" ? `Объекты демонтажа (изменений): ${message.viewDismantling}` : ""}
${message.changes.length > 0 ? `⭐️ Пожелания по изменениям` : ""}
${message.changes ? `${message.changes.map((task) => `● ${task}`).join("\n")}` : ""}
${message.dopChanges != "" ? `Дополнительные требования: ${message.dopChanges}` : ""}
${message.dopInfo.length > 0 || message.detailsInfo != "" ? `[line]` : ""}
${message.dopInfo.length > 0 || message.detailsInfo != "" ? `⭐️⭐️⭐️ Дополнительная информация\n` : ""}
${message.dopInfo ? `${message.dopInfo.map((task) => `● ${task}`).join("\n")}` : ""}
${message.detailsInfo != "" ? `Подробности: ${message.detailsInfo}` : ""}
${
  message.experienceGarden != "" ||
  message.hourGarden != "" ||
  message.wantHourGarden != "" ||
  message.likeWork != "" ||
  message.interfereGarden != ""
    ? `[line]`
    : ""
}
${
  message.experienceGarden != "" ||
  message.hourGarden != "" ||
  message.wantHourGarden != "" ||
  message.likeWork != "" ||
  message.interfereGarden != ""
    ? `⭐️⭐️⭐️ Обслуживание сада\n`
    : ""
}
${message.experienceGarden != "" ? `Опыт работы: ${message.experienceGarden}` : ""}
${message.hourGarden != "" ? `Времяпрепровождение в саду (время): ${message.hourGarden}` : ""}
${message.wantHourGarden != "" ? `Желаемое времяпрепровождение в саду (время): ${message.wantHourGarden}` : ""}
${message.likeWork != "" ? `Любимые садовые работы: ${message.likeWork}` : ""}
${message.interfereGarden != "" ? `Что мешает в саду: ${message.interfereGarden}` : ""}
`,
  ]
    .filter(Boolean)
    .join("\n");

  return {
    file_name: message.fio,
    chat_id: CHATS_ID.BASE,
    topic_id: TOPICS_ID.LANDSCAPE,
    text,
  };
});

async function clickBtn() {
  sendingStatus.isLoading = true;
  sendingStatus.error = null;

  try {
    const response = await sendMessageTG(formattedText.value);
    if (response && response.ok) {
      sendingStatus.isSuccess = true;
      snackbar.value = true;
    } else {
      sendingStatus.error = "Произошла ошибка при отправке. Пожалуйста, попробуйте еще раз.";
    }
  } catch (err) {
    sendingStatus.error = "Произошла ошибка при отправке. Пожалуйста, попробуйте еще раз.";
    console.error("Ошибка отправки:", err);
  } finally {
    sendingStatus.isLoading = false;
  }
}

// async function sendMessage() {
//   try {
//     const formattedText = `
// 👨🏻 Анкета для ТЗ
// ${message.fio != "" || message.address != "" || message.kadastr != "" || message.phone != "" ? `[line]` : ""}
// ${message.fio != "" ? `ФИО: ${message.fio}` : ""}
// ${message.address != "" ? `Адрес клиента: ${message.address}` : ""}
// ${message.kadastr != "" ? `Адрес участка: ${message.kadastr}` : ""}
// ${message.phone != "" ? `Телефон: ${message.phone}` : ""}
// ${
//   message.countPeople != "" ||
//   message.countPeopleDop != "" ||
//   message.ageClient != "" ||
//   message.children != "" ||
//   message.childrenAge != "" ||
//   message.animal != "" ||
//   message.personGroup.length > 0 ||
//   message.inval.length > 0 ||
//   message.allergy.length > 0
//     ? `[line]`
//     : ""
// }
// ${
//   message.countPeople != "" ||
//   message.countPeopleDop != "" ||
//   message.ageClient != "" ||
//   message.children != "" ||
//   message.childrenAge != "" ||
//   message.animal != "" ||
//   message.personGroup.length > 0 ||
//   message.inval.length > 0 ||
//   message.allergy.length > 0
//     ? `⭐️⭐️⭐️ Дополнительные сведения\n`
//     : ""
// }
// ${message.countPeople != "" ? `Число проживающих на участке: ${message.countPeople}` : ""}
// ${message.countPeopleDop != "" ? `В том числе проживают: ${message.countPeopleDop}` : ""}
// ${message.ageClient != "" ? `Возраст клиента(ов): ${message.ageClient}` : ""}
// ${message.children != "" ? `Дети: ${message.children}` : ""}
// ${message.childrenAge != "" ? `Возраст ребенка (детей): ${message.childrenAge}` : ""}
// ${message.animal != "" ? `Домашние животные: ${message.animal}` : ""}
// ${message.personGroup.length > 0 ? `● Обслуживающий персонал` : ""}
// ${message.personGroup ? `${message.personGroup.map((task) => `● ${task}`).join("\n")}` : ""}
// ${message.inval.length > 0 ? `⭐️ Маломобильные пользователи` : ""}
// ${message.inval ? `${message.inval.map((task) => `● ${task}`).join("\n")}` : ""}
// ${message.allergy != "" ? `● Наличие аллергических реакций: ${message.allergy}` : ""}
// ${message.isAllergy != "" ? `На что аллергия: ${message.isAllergy}` : ""}
// ${
//   message.leisure.length > 0 ||
//   message.hobby.length > 0 ||
//   message.utilityBlock.length > 0 ||
//   message.air.length > 0 ||
//   message.addReq != ""
//     ? `[line]`
//     : ""
// }
// ${
//   message.leisure.length > 0 ||
//   message.hobby.length > 0 ||
//   message.utilityBlock.length > 0 ||
//   message.air.length > 0 ||
//   message.addReq != ""
//     ? `⭐️⭐️⭐️ Функциональные зоны\n`
//     : ""
// }
// ${message.leisure.length > 0 ? `⭐️ Отдых (досуг)` : ""}
// ${message.leisure ? `${message.leisure.map((task) => `● ${task}`).join("\n")}` : ""}
// ${message.alcove != "" ? `Максимально людей в беседке: ${message.alcove}` : ""}
// ${message.terrace != "" ? `Максимально людей на террасе: ${message.terrace}` : ""}

// ${message.hobby.length > 0 ? `⭐️ Хобби` : ""}
// ${message.hobby ? `${message.hobby.map((task) => `● ${task}`).join("\n")}` : ""}
// ${message.sport != "" ? `Вид спорта: ${message.sport}` : ""}
// ${message.utilityBlock.length > 0 ? `⭐️ Хозяйственный блок` : ""}
// ${message.utilityBlock ? `${message.utilityBlock.map((task) => `● ${task}`).join("\n")}` : ""}
// ${message.garage != "" ? `На сколько машин гараж: ${message.garage}` : ""}
// ${message.parking != "" ? `На сколько машин парковка: ${message.parking}` : ""}
// ${message.gardenArea != "" ? `Посадок в огороде: ${message.gardenArea}` : ""}
// ${message.greenhouse != "" ? `Размер теплицы: ${message.greenhouse}` : ""}
// ${message.air != "" ? `● Развлечения на открытом воздухе: ${message.air}` : ""}
// ${message.howOftenAir != "" ? `Переодичность: ${message.howOftenAir}` : ""}
// ${message.dopZone != "" ? `Иная дополнительная зона: ${message.dopZone}` : ""}
// ${message.addReq != "" ? `Дополнительные требования: ${message.addReq}` : ""}
// ${
//   message.garden.length > 0 ||
//   message.style.length > 0 ||
//   message.plants.length > 0 ||
//   message.plantsLike != "" ||
//   message.plantsDisLike != "" ||
//   message.colorLike != "" ||
//   message.colorDisLike != "" ||
//   message.interior != ""
//     ? `[line]`
//     : ""
// }
// ${
//   message.garden.length > 0 ||
//   message.style.length > 0 ||
//   message.plants.length > 0 ||
//   message.plantsLike != "" ||
//   message.plantsDisLike != "" ||
//   message.colorLike != "" ||
//   message.colorDisLike != "" ||
//   message.interior != ""
//     ? `⭐️⭐️⭐️ Предпочтения\n`
//     : ""
// }
// ${message.garden.length > 0 ? `⭐️ Элементы сада` : ""}
// ${message.garden ? `${message.garden.map((task) => `● ${task}`).join("\n")}` : ""}
// ${message.berryBushes != "" ? `Ягодные кустарники: ${message.berryBushes}` : ""}
// ${message.fruitTrees != "" ? `Фруктовые деревья: ${message.fruitTrees}` : ""}
// ${message.collection != "" ? `Коллекция: ${message.collection}` : ""}
// ${message.style.length > 0 ? `⭐️ Стиль` : ""}
// ${message.style ? `${message.style.map((task) => `● ${task}`).join("\n")}` : ""}
// ${message.plants.length > 0 ? `⭐️ Растения` : ""}
// ${message.plants ? `${message.plants.map((task) => `● ${task}`).join("\n")}` : ""}
// ${message.monthOfFlowering != "" ? `Месяц обильного цветения: ${message.monthOfFlowering}` : ""}
// ${message.plantsLike != "" ? `Растения которые нравятся: ${message.plantsLike}` : ""}
// ${message.plantsDisLike != "" ? `Растения которые не нравятся: ${message.plantsDisLike}` : ""}
// ${message.colorLike != "" || message.colorDisLike != "" || message.interior != "" ? `⭐️ Цветовые предпочтения` : ""}
// ${message.colorLike != "" ? `Цвета которые нравятся: ${message.colorLike}` : ""}
// ${message.colorDisLike != "" ? `Цвета которые не нравятся: ${message.colorDisLike}` : ""}
// ${message.interior != "" ? `Оттенки интерьера для ландшафта: ${message.interior}` : ""}
// ${
//   message.lighting.length > 0 ||
//   message.irrigationSystem.length > 0 ||
//   message.water.length > 0 ||
//   message.buildingMaterials > 0 ||
//   message.dismantling > 0 ||
//   message.viewDismantling != "" ||
//   message.changes > 0 ||
//   message.dopChanges != ""
//     ? `[line]`
//     : ""
// }
// ${
//   message.lighting.length > 0 ||
//   message.irrigationSystem.length > 0 ||
//   message.water.length > 0 ||
//   message.buildingMaterials > 0 ||
//   message.dismantling > 0 ||
//   message.viewDismantling != "" ||
//   message.changes > 0 ||
//   message.dopChanges != ""
//     ? `⭐️⭐️⭐️ Технические вопросы\n`
//     : ""
// }
// ${message.lighting.length > 0 ? `⭐️ Система освещения` : ""}
// ${message.lighting ? `${message.lighting.map((task) => `● ${task}`).join("\n")}` : ""}
// ${message.irrigationSystem.length > 0 ? `⭐️ Система полива` : ""}
// ${message.irrigationSystem ? `${message.irrigationSystem.map((task) => `● ${task}`).join("\n")}` : ""}
// ${message.water.length > 0 ? `⭐️ Точка подключения воды` : ""}
// ${message.water ? `${message.water.map((task) => `● ${task}`).join("\n")}` : ""}
// ${message.buildingMaterials.length > 0 ? `⭐️ Строительные материалы` : ""}
// ${message.buildingMaterials ? `${message.buildingMaterials.map((task) => `● ${task}`).join("\n")}` : ""}
// ${message.dismantling.length > 0 ? `⭐️ Демонтаж и изменения` : ""}
// ${message.dismantling ? `${message.dismantling.map((task) => `● ${task}`).join("\n")}` : ""}
// ${message.viewDismantling != "" ? `Объекты демонтажа (изменений): ${message.viewDismantling}` : ""}
// ${message.changes.length > 0 ? `⭐️ Пожелания по изменениям` : ""}
// ${message.changes ? `${message.changes.map((task) => `● ${task}`).join("\n")}` : ""}
// ${message.dopChanges != "" ? `Дополнительные требования: ${message.dopChanges}` : ""}
// ${message.dopInfo.length > 0 || message.detailsInfo != "" ? `[line]` : ""}
// ${message.dopInfo.length > 0 || message.detailsInfo != "" ? `⭐️⭐️⭐️ Дополнительная информация\n` : ""}
// ${message.dopInfo ? `${message.dopInfo.map((task) => `● ${task}`).join("\n")}` : ""}
// ${message.detailsInfo != "" ? `Подробности: ${message.detailsInfo}` : ""}
// ${
//   message.experienceGarden != "" ||
//   message.hourGarden != "" ||
//   message.wantHourGarden != "" ||
//   message.likeWork != "" ||
//   message.interfereGarden != ""
//     ? `[line]`
//     : ""
// }
// ${
//   message.experienceGarden != "" ||
//   message.hourGarden != "" ||
//   message.wantHourGarden != "" ||
//   message.likeWork != "" ||
//   message.interfereGarden != ""
//     ? `⭐️⭐️⭐️ Обслуживание сада\n`
//     : ""
// }
// ${message.experienceGarden != "" ? `Опыт работы: ${message.experienceGarden}` : ""}
// ${message.hourGarden != "" ? `Времяпрепровождение в саду (время): ${message.hourGarden}` : ""}
// ${message.wantHourGarden != "" ? `Желаемое времяпрепровождение в саду (время): ${message.wantHourGarden}` : ""}
// ${message.likeWork != "" ? `Любимые садовые работы: ${message.likeWork}` : ""}
// ${message.interfereGarden != "" ? `Что мешает в саду: ${message.interfereGarden}` : ""}
// `
//       .replace(/\./g, "\\\.")
//       .replace(/-/g, "\\-")
//       .replace(/\n+/g, "\n")
//       .replace(/\s*\[line\]/g, "\n")
//       .replace(/=/g, "\\=")
//       .replace(/>/g, "\\>")
//       .replace(/\+/g, "\\+")
//       .replace(/\(/g, "\\(")
//       .replace(/\)/g, "\\)")
//       .replace(/\]/g, "\\]")
//       .replace(/\[/g, "\\[")
//       .replace(/_/g, "\\_")
//       .replace(/\*/g, "\\*")
//       .replace(/~/g, "\\~")
//       .replace(/`/g, "\\`")
//       .replace(/#/g, "\\#")
//       .replace(/\|/g, "\\|")
//       .replace(/{/g, "\\{")
//       .replace(/}/g, "\\}")
//       .replace(/!/g, "\\!")
//       .trim();
//     // await axios
//     //   .post(`https://api.telegram.org/bot${token}/sendMessage`, {
//     //     // chat_id: CHATS_ID.BASE,
//     //     chat_id: CHATS_ID.BASE_DEV,
//     //     text: formattedText,
//     //     parse_mode: "MarkdownV2",
//     //     message_thread_id: 4294967414, //DEV
//     //     // message_thread_id: 4294967339,
//     //     polling: true,
//     //   })
//     //   .then(() => {
//     //     snackbar.value = true;
//     //   });

//     const blob = new Blob([formattedText], { type: "text/plain" });
//     const formData = new FormData();
//     formData.append("document", blob, message.fio + ".txt");
//     formData.append("chat_id", CHATS_ID.BASE_DEV);
//     // formData.append("message_thread_id", "4294967414");
//     formData.append("message_thread_id", "4294967414");

//     await axios.post(`https://api.telegram.org/bot${token}/sendDocument`, formData, {
//       headers: { "Content-Type": "multipart/form-data" },
//     });
//   } catch (error) {
//     console.error("Ошибка при отправке сообщения:", error);
//   }
// }

// Состояние для отслеживания открытия combobox
const isAnyComboboxOpen = ref(false);
const currentOpenCombobox = ref(null); // Текущий открытый combobox

// Обработчик клика на combobox
const handleComboboxClick = (refName) => {
  if (currentOpenCombobox.value && currentOpenCombobox.value !== refName) {
    // Закрываем текущий открытый combobox
    closeCombobox(currentOpenCombobox.value);
  }
  currentOpenCombobox.value = refName;
};

// Обработчик открытия/закрытия меню
const handleMenuUpdate = (isOpen, refName) => {
  isAnyComboboxOpen.value = isOpen;
  currentOpenCombobox.value = isOpen ? refName : null;
};

// Закрыть combobox
const closeCombobox = (refName) => {
  const combobox = document.querySelector(`.${refName} .v-menu__content`);
  if (combobox) {
    combobox.style.display = "none"; // Закрываем меню
  }
  isAnyComboboxOpen.value = false;
  currentOpenCombobox.value = null;
};

function isMobileDevice() {
  return window.screen.width < 768 || window.screen.height < 768;
}

onMounted(() => {
  if (isMobileDevice()) {
    document.querySelectorAll("input, textarea").forEach((input) => {
      input.addEventListener("focus", () => {
        input.scrollIntoView({ behavior: "smooth", block: "start" });
      });
    });
  }
});
</script>

<style lang="scss" scoped>
.survey-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem 1rem;
  font-family: "Roboto", sans-serif;
}

.survey-header {
  text-align: center;
  margin-bottom: 3rem;

  .survey-title {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    position: relative;
    display: inline-block;

    .title-gradient {
      background: linear-gradient(90deg, #2c3e50, #1a1a1a);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    .title-underline {
      position: absolute;
      bottom: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 4px;
      background: linear-gradient(90deg, #ea5b0c, #ff8c42);
      border-radius: 2px;
      transition: width 0.3s ease;
    }

    &:hover .title-underline {
      width: 120px;
    }
  }

  .survey-subtitle {
    color: #5a6a7a;
    font-size: 1.1rem;
    margin-top: 0.5rem;
  }
}

.form-sections {
  display: grid;
  grid-template-columns: 1fr;
  gap: 1.5rem;
  max-width: 900px;
  margin: 0 auto;
}

.form-section {
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08) !important;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  overflow: hidden;
  width: 100%;

  &:hover {
    // transform: translateY(-2px);
    box-shadow: 0 6px 24px rgba(0, 0, 0, 0.12) !important;
  }

  .section-title {
    background: linear-gradient(to right, #f5f7fa, #ffffff);
    padding: 1.25rem 1.5rem;
    border-bottom: 1px solid #f0f0f0;
    font-weight: 600;
    color: #2c3e50;
    font-size: 1.25rem;
  }

  .v-card-text {
    padding: 1.5rem;
  }
}

.form-actions {
  display: flex;
  justify-content: center;
  margin-top: 2.5rem;

  .submit-btn {
    background: linear-gradient(135deg, #ff8c42, #ea5b0c) !important;
    color: white !important;
    padding: 0 2rem !important;
    height: 48px !important;
    font-weight: 500 !important;
    letter-spacing: 0.5px;
    // text-transform: none;
    font-size: 1rem;
    transition: all 0.3s ease;

    &:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(234, 91, 12, 0.3) !important;
    }
  }
}

.v-text-field,
.v-select,
.v-textarea {
  :deep(.v-field) {
    border-radius: 8px;
    background-color: #f9f9f9;
  }

  :deep(.v-field--focused) {
    background-color: white;
    // box-shadow: 0 0 0 2px rgba(234, 91, 12, 0.2);
  }
}

.v-snackbar {
  :deep(.v-snackbar__content) {
    font-weight: 500;
    padding: 0.75rem 1.25rem;
  }
}

@media (max-width: 960px) {
  .survey-container {
    padding: 1.5rem;
  }

  .survey-title {
    font-size: 2rem;
  }

  .form-section {
    .section-title {
      padding: 1rem;
      font-size: 1.1rem;
    }

    .v-card-text {
      padding: 1rem;
    }
  }
}

@media (max-width: 600px) {
  .survey-container {
    padding: 1rem;
  }

  .survey-title {
    font-size: 1.75rem;

    .title-underline {
      width: 60px;
      height: 3px;
      bottom: -6px;
    }

    &:hover .title-underline {
      width: 80px;
    }
  }

  .survey-subtitle {
    font-size: 1rem;
  }

  .form-actions {
    .submit-btn {
      // width: 100%;
    }
  }
}
</style>
